---
title: "Getting WAStD"
author: "Florian Mayer"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting WAStD}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Get WAStD

After setting up `wastdr`'s authentication in vignette "Setup", 
we can now retrieve data using `get_wastd` to send `GET` requests to the `WAStD` 
API.


```{r}
library(wastdr)
library(dplyr)
library(magrittr)
library(leaflet)
library(listviewer)
library(DT)
library(ggplot2)
```

```{r call_api, eval=FALSE}
tne <- wastd_GET('turtle-nest-encounters')
listviewer::jsonedit(tne$content, width = 800, height = 600)
tracks <- parse_turtle_nest_encounters(tne)
```

For this vignette, we'll use the packaged example data.

```{r, eval=T}
data(animal_encounters)
data(nests)
```

```{r load_vignette_data, eval=FALSE}
load(file = "vignettes/data.rda")
```

```{r inspect_data}
listviewer::jsonedit(animal_encounters$features, width = 800, height = 600)

animals <- parse_animal_encounters(animal_encounters)
nests <- parse_turtle_nest_encounters(nests)

DT::datatable(animals)
# DT::datatable(nests)

```

```{r surveys, fig.height=5, fig.width=10, eval=FALSE}
survey_res <- wastd_GET("surveys")
surveys <- survey_res %>% parse_surveys()

surveys_pth <- surveys %>% dplyr::filter(site_id %in% c(35, 45)) 

# survey_ts_plot <- . %>% dplyr::group_by(date, site_name) %>% dplyr::tally %>%
# ggplot(., aes(date, n, fill=site_name)) + ggplot2::geom_tile() + theme_minimal() + labs(title="Surveys", fill="Site", y="Number of surveys", x="Date")
```


## Filtering data
This section will be expanded to show how to filter the data, e.g.

* All data from an area (marine protected area, location, study site)
* All data collected or recorded by a certain person
* All data with specific properties, e.g. only certain stranding types, taxonomic groups etc.
